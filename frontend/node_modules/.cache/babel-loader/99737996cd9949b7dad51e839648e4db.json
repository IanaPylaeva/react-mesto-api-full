{"ast":null,"code":"import _toConsumableArray from\"C:/Users/\\u043F\\u043E\\u043B\\u044C\\u0437\\u043E\\u0432\\u0430\\u0442\\u0435\\u043B\\u044C/dev/react-mesto-api-full/frontend/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _slicedToArray from\"C:/Users/\\u043F\\u043E\\u043B\\u044C\\u0437\\u043E\\u0432\\u0430\\u0442\\u0435\\u043B\\u044C/dev/react-mesto-api-full/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useEffect}from\"react\";import{Routes,Route,Navigate,useNavigate}from\"react-router-dom\";import api from\"../utils/api.js\";import*as auth from\"../utils/auth.js\";import Header from\"./Header.js\";import Main from\"./Main.js\";import Footer from\"./Footer.js\";import ImagePopup from\"./ImagePopup.js\";import EditProfilePopup from\"./EditProfilePopup.js\";import EditAvatarPopup from\"./EditAvatarPopup.js\";import AddPlacePopup from\"./AddPlacePopup.js\";import{CurrentUserContext}from'../contexts/CurrentUserContext.js';import Login from\"./Login.js\";import Register from\"./Register.js\";import ProtectedRoute from\"./ProtectedRoute.js\";import InfoTooltip from'./InfoTooltip.js';import success from'../images/success.svg';import fail from'../images/fail.svg';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var defaultSelectedCard={name:'',link:''};function App(){var navigate=useNavigate();var _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),isEditProfilePopupOpen=_React$useState2[0],setIsEditProfilePopupOpen=_React$useState2[1];var _React$useState3=React.useState(false),_React$useState4=_slicedToArray(_React$useState3,2),isAddPlacePopupOpen=_React$useState4[0],setIsAddPlacePopupOpen=_React$useState4[1];var _React$useState5=React.useState(false),_React$useState6=_slicedToArray(_React$useState5,2),isEditAvatarPopupOpen=_React$useState6[0],setIsEditAvatarPopupOpen=_React$useState6[1];var _React$useState7=React.useState(defaultSelectedCard),_React$useState8=_slicedToArray(_React$useState7,2),selectedCard=_React$useState8[0],setSelectedCard=_React$useState8[1];var _React$useState9=React.useState({}),_React$useState10=_slicedToArray(_React$useState9,2),currentUser=_React$useState10[0],setCurrentUser=_React$useState10[1];var _React$useState11=React.useState([]),_React$useState12=_slicedToArray(_React$useState11,2),cards=_React$useState12[0],setCards=_React$useState12[1];var _React$useState13=React.useState(false),_React$useState14=_slicedToArray(_React$useState13,2),isLoggedIn=_React$useState14[0],setIsLoggedIn=_React$useState14[1];var _React$useState15=React.useState(null),_React$useState16=_slicedToArray(_React$useState15,2),email=_React$useState16[0],setEmail=_React$useState16[1];var _React$useState17=React.useState(''),_React$useState18=_slicedToArray(_React$useState17,2),popupImage=_React$useState18[0],setPopupImage=_React$useState18[1];var _React$useState19=React.useState(''),_React$useState20=_slicedToArray(_React$useState19,2),popupTitle=_React$useState20[0],setPopupTitle=_React$useState20[1];var _React$useState21=React.useState(false),_React$useState22=_slicedToArray(_React$useState21,2),infoTooltip=_React$useState22[0],setInfoTooltip=_React$useState22[1];var _React$useState23=React.useState(false),_React$useState24=_slicedToArray(_React$useState23,2),isImagePopupOpen=_React$useState24[0],setIsImagePopupOpen=_React$useState24[1];/* Регистрация */function register(email,password){auth.registerUser(email,password).then(function(){setPopupImage(success);setPopupTitle(\"Вы успешно зарегистрировались!\");navigate(\"/sign-in\");}).catch(function(){setPopupImage(fail);setPopupTitle(\"Что-то пошло не так! Попробуйте ещё раз.\");}).finally(handleInfoTooltip);}/* Вход */function logIn(email,password){auth.loginUser(email,password).then(function(res){localStorage.setItem('jwt',res.token);setIsLoggedIn(true);setEmail(email);navigate(\"/\");}).catch(function(){setPopupImage(fail);setPopupTitle(\"Что-то пошло не так! Попробуйте ещё раз.\");handleInfoTooltip();});}/* Сохранить токен в локальном хранилище, установить имейл */useEffect(function(){var jwt=localStorage.getItem('jwt');if(jwt){auth.getContent(jwt).then(function(res){if(res){setIsLoggedIn(true);setEmail(res.data.email);}}).catch(function(err){console.error(err);});}},[]);useEffect(function(){if(isLoggedIn){navigate(\"/\");}},[isLoggedIn,navigate]);/* Одновременное получение данных пользователя и карточек */useEffect(function(){Promise.all([api.getUserData(),api.getInitialCards()]).then(function(res){setCurrentUser(res[0]);setCards(res[1]);}).catch(function(err){console.log(err);});},[]);function handleEditProfileClick(){setIsEditProfilePopupOpen(true);}function handleAddPlaceClick(){setIsAddPlacePopupOpen(true);}function handleEditAvatarClick(){setIsEditAvatarPopupOpen(true);}function handleCardClick(card){setSelectedCard(card);setIsImagePopupOpen(true);}function handleInfoTooltip(){setInfoTooltip(true);}/* Сброс всех параметров после logout */function handleLogOut(){setIsLoggedIn(false);setEmail(null);navigate(\"/sign-in\");localStorage.removeItem(\"jwt\");//удаление токена из локального хранилища\n}/* Ставим и убираем лайк на карточке */function handleCardLike(card){var isLiked=card.likes.some(function(i){return i._id===currentUser._id;});// Снова проверяем, есть ли уже лайк на этой карточке\nvar action=!isLiked?api.putLike(card._id):api.deleteLike(card._id);action.then(function(newCard){setCards(function(state){return state.map(function(c){return c._id===card._id?newCard:c;});});}).catch(function(err){console.error(err);});}/* Удаляет карточку */function handleCardDelete(card){api.deleteCard(card._id).then(function(){setCards(function(items){return items.filter(function(i){return i._id!==card._id;});});}).catch(function(err){console.error(err);});}/* Обновляет данные пользователя */function handleUpdateUser(data){api.patchUserInfo(data).then(function(newUser){setCurrentUser(newUser);closeAllPopups();}).catch(function(err){console.error(err);});}/* Обновляет аватар */function handleAvatarUpdate(data){api.patchUserAvatar(data).then(function(newAvatar){setCurrentUser(newAvatar);closeAllPopups();}).catch(function(err){console.error(err);});}/* Добавляет карточку */function handleAddPlaceSubmit(card){api.postCard(card).then(function(data){setCards([data].concat(_toConsumableArray(cards)));closeAllPopups();}).catch(function(err){console.error(err);});}/* Закрытие всех попапов */function closeAllPopups(){setIsEditProfilePopupOpen(false);setIsAddPlacePopupOpen(false);setIsEditAvatarPopupOpen(false);setSelectedCard(defaultSelectedCard);setInfoTooltip(false);setIsImagePopupOpen(false);}return/*#__PURE__*/_jsx(CurrentUserContext.Provider,{value:currentUser,children:/*#__PURE__*/_jsxs(\"div\",{className:\"page\",children:[/*#__PURE__*/_jsx(Header,{mail:email,onClick:handleLogOut,route:\"\"}),/*#__PURE__*/_jsxs(Routes,{children:[/*#__PURE__*/_jsx(Route,{exact:true,path:\"/\",element:/*#__PURE__*/_jsx(ProtectedRoute,{component:Main,isLogged:isLoggedIn,onCardClick:handleCardClick,onEditProfile:handleEditProfileClick,onAddPlace:handleAddPlaceClick,onEditAvatar:handleEditAvatarClick,onCardLike:handleCardLike,onCardDelete:handleCardDelete,cards:cards})}),/*#__PURE__*/_jsx(Route,{path:\"/sign-up\",element:/*#__PURE__*/_jsx(Register,{register:register})}),/*#__PURE__*/_jsx(Route,{path:\"/sign-in\",element:/*#__PURE__*/_jsx(Login,{logIn:logIn})}),/*#__PURE__*/_jsx(Route,{path:\"*\",element:/*#__PURE__*/_jsx(Navigate,{to:\"/\"})})]}),/*#__PURE__*/_jsx(Footer,{}),/*#__PURE__*/_jsx(EditProfilePopup,{isOpen:isEditProfilePopupOpen,onClose:closeAllPopups,onUpdateUser:handleUpdateUser}),/*#__PURE__*/_jsx(AddPlacePopup,{isOpen:isAddPlacePopupOpen,onClose:closeAllPopups,onAddNewPlace:handleAddPlaceSubmit}),/*#__PURE__*/_jsx(EditAvatarPopup,{isOpen:isEditAvatarPopupOpen,onClose:closeAllPopups,onUpdateAvatar:handleAvatarUpdate}),/*#__PURE__*/_jsx(ImagePopup,{card:selectedCard,onClose:closeAllPopups,isOpen:isImagePopupOpen}),/*#__PURE__*/_jsx(InfoTooltip,{image:popupImage,title:popupTitle,isOpen:infoTooltip,onClose:closeAllPopups})]})});}export default App;","map":{"version":3,"sources":["C:/Users/пользователь/dev/react-mesto-api-full/frontend/src/components/App.js"],"names":["React","useEffect","Routes","Route","Navigate","useNavigate","api","auth","Header","Main","Footer","ImagePopup","EditProfilePopup","EditAvatarPopup","AddPlacePopup","CurrentUserContext","Login","Register","ProtectedRoute","InfoTooltip","success","fail","defaultSelectedCard","name","link","App","navigate","useState","isEditProfilePopupOpen","setIsEditProfilePopupOpen","isAddPlacePopupOpen","setIsAddPlacePopupOpen","isEditAvatarPopupOpen","setIsEditAvatarPopupOpen","selectedCard","setSelectedCard","currentUser","setCurrentUser","cards","setCards","isLoggedIn","setIsLoggedIn","email","setEmail","popupImage","setPopupImage","popupTitle","setPopupTitle","infoTooltip","setInfoTooltip","isImagePopupOpen","setIsImagePopupOpen","register","password","registerUser","then","catch","finally","handleInfoTooltip","logIn","loginUser","res","localStorage","setItem","token","jwt","getItem","getContent","data","err","console","error","Promise","all","getUserData","getInitialCards","log","handleEditProfileClick","handleAddPlaceClick","handleEditAvatarClick","handleCardClick","card","handleLogOut","removeItem","handleCardLike","isLiked","likes","some","i","_id","action","putLike","deleteLike","newCard","state","map","c","handleCardDelete","deleteCard","items","filter","handleUpdateUser","patchUserInfo","newUser","closeAllPopups","handleAvatarUpdate","patchUserAvatar","newAvatar","handleAddPlaceSubmit","postCard"],"mappings":"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","sourcesContent":["import React, { useEffect } from \"react\";\r\nimport { Routes, Route, Navigate, useNavigate } from \"react-router-dom\";\r\nimport api from \"../utils/api.js\";\r\nimport * as auth from \"../utils/auth.js\";\r\nimport Header from \"./Header.js\";\r\nimport Main from \"./Main.js\";\r\nimport Footer from \"./Footer.js\";\r\nimport ImagePopup from \"./ImagePopup.js\";\r\nimport EditProfilePopup from \"./EditProfilePopup.js\";\r\nimport EditAvatarPopup from \"./EditAvatarPopup.js\";\r\nimport AddPlacePopup from \"./AddPlacePopup.js\";\r\nimport { CurrentUserContext } from '../contexts/CurrentUserContext.js';\r\nimport Login from \"./Login.js\";\r\nimport Register from \"./Register.js\";\r\nimport ProtectedRoute from \"./ProtectedRoute.js\";\r\nimport InfoTooltip from './InfoTooltip.js';\r\nimport success from '../images/success.svg';\r\nimport fail from '../images/fail.svg';\r\n\r\nconst defaultSelectedCard = { name: '', link: '' };\r\n\r\nfunction App() {\r\n  const navigate = useNavigate();\r\n  const [isEditProfilePopupOpen, setIsEditProfilePopupOpen] = React.useState(false);\r\n  const [isAddPlacePopupOpen, setIsAddPlacePopupOpen] = React.useState(false);\r\n  const [isEditAvatarPopupOpen, setIsEditAvatarPopupOpen] = React.useState(false);\r\n  const [selectedCard, setSelectedCard] = React.useState(defaultSelectedCard);\r\n  const [currentUser, setCurrentUser] = React.useState({});\r\n  const [cards, setCards] = React.useState([]);\r\n  const [isLoggedIn, setIsLoggedIn] = React.useState(false);\r\n  const [email, setEmail] = React.useState(null);\r\n  const [popupImage, setPopupImage] = React.useState('');\r\n  const [popupTitle, setPopupTitle] = React.useState('');\r\n  const [infoTooltip, setInfoTooltip] = React.useState(false);\r\n  const [isImagePopupOpen, setIsImagePopupOpen] = React.useState(false);\r\n\r\n  /* Регистрация */\r\n  function register(email, password) {\r\n    auth.registerUser(email, password).then(() => {\r\n      setPopupImage(success);\r\n      setPopupTitle(\"Вы успешно зарегистрировались!\");\r\n      navigate(\"/sign-in\");\r\n    }).catch(() => {\r\n      setPopupImage(fail);\r\n      setPopupTitle(\"Что-то пошло не так! Попробуйте ещё раз.\");\r\n    }).finally(handleInfoTooltip);\r\n  }\r\n\r\n  /* Вход */\r\n  function logIn(email, password) {\r\n    auth.loginUser(email, password).then((res) => {\r\n      localStorage.setItem('jwt', res.token);\r\n      setIsLoggedIn(true);\r\n      setEmail(email);\r\n      navigate(\"/\");\r\n    }).catch(() => {\r\n      setPopupImage(fail);\r\n      setPopupTitle(\"Что-то пошло не так! Попробуйте ещё раз.\");\r\n      handleInfoTooltip();\r\n    })\r\n  }\r\n\r\n  /* Сохранить токен в локальном хранилище, установить имейл */\r\n  useEffect(() => {\r\n    const jwt = localStorage.getItem('jwt');\r\n    if (jwt) {\r\n      auth.getContent(jwt).then((res) => {\r\n        if (res) {\r\n          setIsLoggedIn(true);\r\n          setEmail(res.data.email);\r\n        }\r\n      }).catch((err) => {\r\n        console.error(err);\r\n      })\r\n    }\r\n  }, []);\r\n  \r\n  useEffect(() => {\r\n    if (isLoggedIn) {\r\n      navigate(\"/\");\r\n    }\r\n  }, [isLoggedIn, navigate]);\r\n  \r\n  /* Одновременное получение данных пользователя и карточек */\r\n  useEffect(() => { \r\n    Promise.all([api.getUserData(), api.getInitialCards()])\r\n      .then((res) => {\r\n        setCurrentUser(res[0]);\r\n        setCards(res[1]);\r\n      })\r\n      .catch((err) => {\r\n        console.log(err);\r\n      });\r\n    }, []);\r\n\r\n  function handleEditProfileClick(){\r\n    setIsEditProfilePopupOpen(true);\r\n  }\r\n  function handleAddPlaceClick(){\r\n    setIsAddPlacePopupOpen(true);\r\n  }\r\n  function handleEditAvatarClick(){\r\n    setIsEditAvatarPopupOpen(true);\r\n  }\r\n  function handleCardClick(card){\r\n    setSelectedCard(card);\r\n    setIsImagePopupOpen(true);\r\n  }\r\n  function handleInfoTooltip(){\r\n    setInfoTooltip(true);\r\n  }\r\n\r\n  /* Сброс всех параметров после logout */\r\n  function handleLogOut() {\r\n    setIsLoggedIn(false);\r\n    setEmail(null);\r\n    navigate(\"/sign-in\");\r\n    localStorage.removeItem(\"jwt\");//удаление токена из локального хранилища\r\n  }\r\n\r\n  /* Ставим и убираем лайк на карточке */\r\n  function handleCardLike(card) {\r\n    const isLiked = card.likes.some((i) => i._id === currentUser._id);// Снова проверяем, есть ли уже лайк на этой карточке\r\n    \r\n    const action = !isLiked ? api.putLike(card._id) : api.deleteLike(card._id);\r\n    action\r\n      .then((newCard) => {\r\n        setCards((state) => \r\n        state.map((c) => c._id === card._id ? newCard : c))\r\n      }).catch((err) => {\r\n        console.error(err)\r\n      });    \r\n  }\r\n\r\n  /* Удаляет карточку */\r\n  function handleCardDelete(card) {\r\n    api.deleteCard(card._id)\r\n      .then (() => {\r\n        setCards(items => items.filter((i) => i._id !== card._id));\r\n      }).catch((err) => {\r\n        console.error(err);\r\n      })\r\n  }\r\n\r\n  /* Обновляет данные пользователя */\r\n  function handleUpdateUser(data) {\r\n    api.patchUserInfo(data)\r\n      .then(newUser => {\r\n        setCurrentUser(newUser);\r\n        closeAllPopups();\r\n      }).catch((err) => {\r\n        console.error(err);\r\n      })\r\n  }\r\n\r\n  /* Обновляет аватар */\r\n  function handleAvatarUpdate(data) {\r\n    api.patchUserAvatar(data)\r\n      .then(newAvatar => {\r\n        setCurrentUser(newAvatar);\r\n        closeAllPopups();\r\n      }).catch((err) => {\r\n        console.error(err);\r\n      })\r\n  }\r\n\r\n  /* Добавляет карточку */\r\n  function handleAddPlaceSubmit(card) {\r\n    api.postCard(card)\r\n    .then(data => {\r\n      setCards([data, ...cards]);\r\n      closeAllPopups();\r\n    }).catch((err) => {\r\n      console.error(err);\r\n    })\r\n  }\r\n\r\n  /* Закрытие всех попапов */\r\n  function closeAllPopups() {\r\n    setIsEditProfilePopupOpen(false);\r\n    setIsAddPlacePopupOpen(false);\r\n    setIsEditAvatarPopupOpen(false);\r\n    setSelectedCard(defaultSelectedCard);\r\n    setInfoTooltip(false);\r\n    setIsImagePopupOpen(false);\r\n  }\r\n  \r\n  return (\r\n    <CurrentUserContext.Provider value={currentUser}>\r\n    <div className=\"page\">\r\n      <Header mail={email} onClick={handleLogOut} route=\"\" />    \r\n      <Routes>\r\n        <Route exact path=\"/\" element={\r\n          <ProtectedRoute\r\n            component={Main}\r\n            isLogged={isLoggedIn}\r\n            onCardClick={handleCardClick}\r\n            onEditProfile={handleEditProfileClick}\r\n            onAddPlace={handleAddPlaceClick}\r\n            onEditAvatar={handleEditAvatarClick}\r\n            onCardLike={handleCardLike}\r\n            onCardDelete={handleCardDelete}\r\n            cards={cards}\r\n          ></ProtectedRoute> \r\n        }></Route> \r\n        <Route path=\"/sign-up\" element={\r\n          <Register register={register} />\r\n        }></Route>\r\n        <Route path=\"/sign-in\" element={\r\n          <Login logIn={logIn} />\r\n        }></Route>\r\n        <Route path=\"*\" element={\r\n          <Navigate to=\"/\" />\r\n        }></Route>\r\n      </Routes>\r\n      <Footer />\r\n      <EditProfilePopup\r\n        isOpen={isEditProfilePopupOpen}\r\n        onClose={closeAllPopups}\r\n        onUpdateUser={handleUpdateUser}\r\n      />\r\n      <AddPlacePopup\r\n        isOpen={isAddPlacePopupOpen}\r\n        onClose={closeAllPopups}\r\n        onAddNewPlace={handleAddPlaceSubmit}\r\n      />      \r\n      <EditAvatarPopup\r\n        isOpen={isEditAvatarPopupOpen}\r\n        onClose={closeAllPopups}\r\n        onUpdateAvatar={handleAvatarUpdate}\r\n      />      \r\n      <ImagePopup\r\n        card={selectedCard}\r\n        onClose={closeAllPopups}\r\n        isOpen={isImagePopupOpen}\r\n      />\r\n      <InfoTooltip\r\n        image={popupImage}\r\n        title={popupTitle}\r\n        isOpen={infoTooltip}\r\n        onClose={closeAllPopups}\r\n      />\r\n    </div>\r\n    </CurrentUserContext.Provider>\r\n  );\r\n}\r\n\r\nexport default App;"]},"metadata":{},"sourceType":"module"}